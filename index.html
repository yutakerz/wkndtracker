<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WKNDEXPENSE PRO</title>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="WKNDTRACKER">
    <link rel="apple-touch-icon" href="logo.jpg">
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="splash">
    <div class="spinner"></div>
    <h2 style="color: #64748b; font-size: 1rem; letter-spacing: 2px;">WKND<span style="color:var(--primary)">TRACKER</span></h2>
    <p id="splash-text" style="display:none; color:#64748b; margin-top:10px; font-size:0.8rem;">Logging out...</p>
</div>

<div id="lightbox" ontouchstart="handleTouchStart(event)" ontouchend="handleTouchEnd(event)">
    <div class="lightbox-close" onclick="closeLightbox()">×</div>
    <img id="lightbox-img" src="">
    <div class="lightbox-nav">
        <button class="nav-btn" onclick="navLightbox(-1)">Previous</button>
        <button class="nav-btn" onclick="navLightbox(1)">Next</button>
    </div>
</div>

<div id="login-page">
    <div class="login-box">
        <h1>wknd<span>tracker</span></h1>
        <p>Private Crew Access Only</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18">
            Sign in with Google
        </button>
    </div>
</div>

<div id="cool-alert" class="cool-alert"><span id="alert-icon"></span> <span id="alert-msg"></span></div>

<nav id="main-nav" style="display:none;">
    <div class="nav-links">
        <span class="active" onclick="switchView('dashboard', this)">Home</span>
        <span onclick="switchView('daily', this)">Day</span>
        <span onclick="switchView('weekly', this)">Week</span>
        <span onclick="switchView('monthly', this)">Month</span>
        <span onclick="openMenu()" style="font-size: 1.2rem; padding: 10px 15px;">☰</span>
    </div>
</nav>

<div class="container" id="app-content" style="display:none;">
    <div id="dashboard" class="view active">
        <div class="dashboard-grid">
            <div class="side-col">
                <div class="card dark-card">
                    <h2>Overall Balance & Channels</h2>
                    <div class="net-total" id="total-net">₱0.00</div>
                    <div style="display:flex; justify-content: space-between; font-size: 0.7rem; color:#94a3b8; margin-bottom: 10px;">
                        <span>All-Time Rev: <b id="total-rev" style="color:var(--success)">₱0</b></span>
                        <span>All-Time Exp: <b id="total-exp" style="color:var(--danger)">₱0</b></span>
                    </div>
                    <div id="channel-stats-overall"></div>
                </div>

                <div class="card">
                    <h2 style="color: #64748b;">Shift Income (On hand) - 8AM RESET</h2>
                    <div class="net-total" id="daily-net" style="font-size: 1.6rem; color: var(--success);">₱0.00</div>
                    <div style="margin-bottom: 6px; border-bottom: 1px solid #eee;"></div>
                    <div id="channel-stats-daily"></div>
                </div>

                <div class="card">
                    <h2 style="color: #64748b;">Loyverse Shift Income - 8AM reset</h2>
                    <div id="loyverse-net-display" style="font-size: 1.6rem; font-weight: 800; color: #1e293b; margin-bottom: 6px;">₱0.00</div>
                    <div style="margin-bottom: 6px; border-bottom: 1px solid #eee;"></div>
                    <div id="channel-stats-loyverse-net"></div>
                </div>

                <div class="card">
                    <h2 style="color: #64748b;">Transfer Funds</h2>
                    <div style="display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
                        <select id="tf-from" style="padding: 8px; flex: 1;"><option>Cash</option><option>GCash</option><option>Maya</option><option>BPI</option></select>
                        <span style="font-size: 0.7rem; color: #94a3b8;">to</span>
                        <select id="tf-to" style="padding: 8px; flex: 1;"><option>Cash</option><option>GCash</option><option>Maya</option><option>BPI</option></select>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <input type="number" id="tf-amt" placeholder="Amount (₱)" style="padding: 8px; flex: 1.5;">
                        <button class="btn btn-primary" id="btn-tf" style="padding: 8px; flex: 1; font-size: 0.75rem;" onclick="confirmTransfer()">Transfer</button>
                    </div>
                </div>
            </div>

            <div class="main-col">
                <div class="card">
                    <h2 style="color: #64748b;">Loyverse (Shift Profit)</h2>
                    <div class="input-stack">
                        <input type="number" id="loyverse-input" placeholder="Amount (₱)">
                        <select id="loyverse-channel">
                            <option value="Cash">Cash</option>
                            <option value="GCash">GCash</option>
                            <option value="Maya">Maya</option>
                            <option value="BPI">BPI</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="btn-loyverse" style="font-size: 0.8rem; margin-top: 10px;" onclick="updateLoyverse()">Confirm</button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px;">
                    <div class="card">
                        <h2 style="color: #64748b;">Daily Post Sales (Shift)</h2>
                        <div class="input-stack">
                            <input type="number" id="rev-amt" placeholder="Amount (₱)">
                            <input type="text" id="rev-staff" placeholder="Put Your Name">
                            <select id="rev-channel"><option>Cash</option><option>GCash</option><option>Maya</option><option>BPI</option><option>Others</option></select>
                        </div>
                        <label style="font-size: 0.6rem; color: #94a3b8; margin-bottom: 5px; display: block;">RECEIPT PHOTOS (MAX 4)</label>
                        <div class="photo-grid">
                            <div class="photo-slot" onclick="clickInput(0, 'REVENUE')" id="rev-slot-0"></div>
                            <div class="photo-slot" onclick="clickInput(1, 'REVENUE')" id="rev-slot-1"></div>
                            <div class="photo-slot" onclick="clickInput(2, 'REVENUE')" id="rev-slot-2"></div>
                            <div class="photo-slot" onclick="clickInput(3, 'REVENUE')" id="rev-slot-3"></div>
                        </div>
                        <input type="file" id="photo-input" hidden accept="image/*" onchange="handlePhoto(this)">
                        <button class="btn btn-success" id="btn-rev" onclick="confirmEntry('REVENUE')">Add Revenue</button>
                    </div>
                    <div class="card">
                        <h2 style="color: #64748b;">Daily Post Expense (Shift)</h2>
                        <div class="input-stack">
                            <input type="number" id="exp-amt" placeholder="Amount (₱)">
                            <input type="text" id="exp-desc" placeholder="Details (e.g Grab, Oatmilk, etc.)">
                            <input type="text" id="exp-staff" placeholder="Put Your Name">
                            <select id="exp-channel"><option>Cash</option><option>GCash</option><option>Maya</option><option>BPI</option></select>
                        </div>
                        <label style="font-size: 0.6rem; color: #94a3b8; margin-bottom: 5px; display: block;">RECEIPT PHOTOS (MAX 4)</label>
                        <div class="photo-grid">
                            <div class="photo-slot" onclick="clickInput(0, 'EXPENSE')" id="exp-slot-0"></div>
                            <div class="photo-slot" onclick="clickInput(1, 'EXPENSE')" id="exp-slot-1"></div>
                            <div class="photo-slot" onclick="clickInput(2, 'EXPENSE')" id="exp-slot-2"></div>
                            <div class="photo-slot" onclick="clickInput(3, 'EXPENSE')" id="exp-slot-3"></div>
                        </div>
                        <button class="btn btn-primary" id="btn-exp" onclick="confirmEntry('EXPENSE')">Add Expense</button>
                    </div>
                </div>
                <div class="card">
                    <h2 style="color: #64748b;">Current Transaction</h2>
                    <div id="log-list" style="max-height:400px; overflow-y:auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="report" class="view">
        <div class="report-header">
            <h1 id="rep-title" style="margin:0">Reports</h1>
            <button class="btn btn-primary" id="btn-print" style="width:auto; padding:10px 30px;" onclick="window.print()">Print PDF</button>
        </div>
        <div class="filter-section">
            <label id="filter-label" style="font-weight: bold; font-size: 0.9rem;"></label>
            
            <input type="date" id="filter-date" style="width: auto; margin-bottom: 0;" onchange="updateReportFilter()">
            

            <div id="week-range-container" style="display:none; align-items:center; gap:5px;">
                <span style="font-size: 0.8rem; color: #94a3b8;">from</span>
                <input type="date" id="filter-date-start" style="width: auto; margin-bottom: 0;" onchange="updateReportFilter()">
                <span style="font-size: 0.8rem; color: #94a3b8;">to</span>
                <input type="date" id="filter-date-end" style="width: auto; margin-bottom: 0;" onchange="updateReportFilter()">
            </div>

            <input type="month" id="filter-month" style="width: auto; margin-bottom: 0; display: none;" onchange="updateReportFilter()">
        </div>
        
        <div id="rep-cards" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:10px; margin-bottom:20px;"></div>
        
        <div class="table-wrap">
            <h3 id="table-label" style="margin: 5px 0 10px; font-size: 0.9rem; color: #64748b;"></h3>
            <table id="main-table"></table>
        </div>
    </div>

    <div id="leaves" class="view">
        <div class="card dark-card" style="padding: 20px; margin-top:10px;">
            <h2 style="border:none; color:#94a3b8; margin-bottom:10px; text-align:center;">ANNUAL LEAVE BALANCE</h2>
            
            <div id="team-balance-list" style="display:flex; flex-direction:column; gap:5px;">
                <div style="text-align:center; color:#64748b; font-size:0.8rem;">Loading balances...</div>
            </div>
        </div>

        <div style="margin: 20px 0; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;">Leave History</h3>
            <button class="btn btn-primary" style="width:auto; padding: 8px 15px; font-size:0.8rem;" onclick="openAddLeaveModal()">+ Add Leave</button>
        </div>

        <div class="card">
            <div id="leave-list">
                <div style="text-align:center; padding:20px; color:#94a3b8;">Loading...</div>
            </div>
        </div>
    </div>

</div>

<div id="modal" class="modal"><div class="modal-content"><h3 id="m-title"></h3><div id="m-body" style="text-align:left; background:#f8fafc; padding:20px; border-radius:15px; margin:20px 0;"></div><div id="m-imgs" style="display:flex; gap:5px; margin-bottom:15px; justify-content:center;"></div><div style="display:flex; gap:10px;"><button class="btn" style="background:#f1f5f9; color:#475569" onclick="closeModal()">Cancel</button><button id="m-confirm" class="btn btn-primary">Confirm</button></div></div></div>
<div id="pwd-modal" class="modal"><div class="modal-content"><h3>Admin Security</h3><p style="font-size:0.8rem; opacity:0.6;">Password Required</p><input type="password" id="p-input" style="text-align:center; margin-bottom:15px;"><div style="display:flex; gap:10px;"><button class="btn" style="background:#f1f5f9; color:#475569" onclick="closePwd()">Cancel</button><button id="p-confirm" class="btn btn-success">Unlock</button></div></div></div>

<div id="add-leave-modal" class="modal">
    <div class="modal-content" style="max-width: 320px; padding: 15px; height: auto; overflow: hidden; border-radius: 20px;">
        <h3 style="margin-top:0; margin-bottom:8px; font-size: 1.1rem;">Add Leave</h3>
        
        <p style="font-size:0.65rem; color:#991b1b; margin:0 0 15px 0; font-style:italic; font-weight:bold; text-align:center;">
            *For 1 day leave, just fill "From"
        </p>

        <div style="display: flex; gap: 12px; margin-bottom: 12px; width: 100%;">
            <div style="flex: 1; min-width: 0; text-align: left;">
                <label style="font-size:0.65rem; color:#64748b; margin-bottom:2px; display:block;">From</label>
                <input type="date" id="leave-start" style="width: 100%; border-radius: 8px;">
            </div>
            <div style="flex: 1; min-width: 0; text-align: left;">
                <label style="font-size:0.65rem; color:#64748b; margin-bottom:2px; display:block;">To</label>
                <input type="date" id="leave-end" style="width: 100%; border-radius: 8px;">
            </div>
        </div>

        <div style="text-align: left; margin-bottom: 12px;">
            <label style="font-size:0.7rem; color:#64748b; margin-bottom:2px; display:block;">Reason</label>
            <textarea id="leave-reason" rows="2" placeholder="State your reason..." style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:8px; resize:none; font-family:inherit; font-size: 0.85rem;"></textarea>
        </div>

        <div style="display:flex; gap:8px;">
            <button class="btn" style="background:#f1f5f9; color:#475569; padding: 8px; flex: 1; font-size: 0.85rem;" onclick="document.getElementById('add-leave-modal').style.display='none'">Cancel</button>
            <button class="btn btn-primary" style="padding: 8px; flex: 1; font-size: 0.85rem;" onclick="submitLeave()">Confirm</button>
        </div>
    </div>
</div>

<div id="leave-details-modal" class="modal">
    <div class="modal-content">
        <h3>Leave Details</h3>
        <div id="leave-detail-content" style="text-align:left; padding:15px; border: 1px solid rgba(255,255,255,0.1); border-radius:12px; margin:15px 0; font-size:0.9rem;"></div>
        <h4 id="manage-leave-title" style="margin:10px 0; font-size:0.8rem; color:#64748b;">Manage Request</h4>
        <div id="leave-actions" style="display:flex; flex-direction:column; gap:10px;"></div>
        <button class="btn" style="background:transparent; color:#94a3b8; margin-top:10px;" onclick="document.getElementById('leave-details-modal').style.display='none'">Close</button>
    </div>
</div>


<div id="menu-modal" class="modal">
    <div class="modal-content" style="max-width: 300px;">
        <h3 style="margin-top:0">Menu</h3>
        
        <div style="text-align: left; margin-bottom: 15px;">
            <label style="font-size: 0.8rem; color: #94a3b8; display:block; margin-bottom:5px;">Theme</label>
            <select id="theme-selector" onchange="setTheme(this.value)" style="width:100%; padding: 10px; border-radius: 8px;">
                <option value="system">System Default</option>
                <option value="light">Light Mode</option>
                <option value="dark">Dark Mode</option>
            </select>
        </div>

        <button class="btn" onclick="openLeaves()" style="background:#d48b32; color:#ffffff; margin-bottom: 10px;">
            Leave Management
        </button>

        <button class="btn btn-primary" onclick="requestNotificationPermission()" style="margin-bottom: 10px;">
            Enable Notifications
        </button>

        <button class="btn btn-danger" onclick="logout()" style="width: 100%;">
            Log Out
        </button>

        <div style="margin-top: 20px;">
            <button class="btn" onclick="closeMenu()" style="background: transparent; color: #94a3b8; padding: 5px;">Close</button>
        </div>
    </div>
</div>

<script src="darkMode.js"></script>
<script src="menu.js"></script>
<script src="leaves.js"></script>
<script src="script.js"></script>

</body>
</html>